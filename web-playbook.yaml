---

- hosts: all
  become: yes
  become_method: sudo
  vars_files:
    - vars/default.yaml
  tasks:
  - name: Create Dir to Downlaod Tomcat.
    file: path=/opt/apps/tomcat state=directory

  - name: Install Java 1.8
    yum: name=java-1.8.0-openjdk state=present

  - name: Download Tomcat
    get_url: url=http://mirrors.estointernet.in/apache/tomcat/tomcat-8/v8.5.51/bin/apache-tomcat-8.5.51.tar.gz dest=/opt/apps/tomcat.tar.gz mode=0755

  - name: Extract Tomcat
    command: "tar zxf /opt/apps/tomcat.tar.gz  -C /opt/apps/tomcat --strip-components 1"

  - name: Copy Index Page Files
    copy: src=wars dest=/opt/apps/tomcat/webapps/ mode=0644
    notify:
    - Restart Tomcat

  - name: Download war files from jfrog
    maven_artifact:
      group_id: com.edurekademo.tutorial
      artifact_id: addressbook
      repository_url: 'http://localhost:8081/artifactory/M1036759/'
      username: "{{ JFROG_USER_ID }}" 
      password: "{{ JFROG_USER_PASSWORD }}"
      dest: /opt/apps/tomcat/webapps/ mode=0644

  handlers:
  - name: Restart Tomcat
    shell: "nohup sh /opt/apps/tomcat/bin/catalina.sh start"
